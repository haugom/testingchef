CHEF_IMAGE_NAME=chef-client

function chef-client() {
  dockerrun chef-client $@
}

function chef() {
  dockerrun chef $@
}

function kitchen() {
  dockerrun kitchen $@
}

function delivery() {
  dockerrun delivery $@
}

function berks() {
  dockerrun berks $@
}

function inspec() {
  dockerrun inspec $@
}

function knife() {
  dockerrun knife $@
}

function dockerrun() {
  CMD=$1
  shift
  docker run \
    -it \
    --rm \
    -u $UID:$UID \
    -v `pwd`:/workdir \
    -v ~/.chef/haugom.pem:/workdir/.chef/haugom.pem:ro \
    -v ~/.chef/haugom.pem:/etc/chef/client.pem:ro \
    -v ~/.ssh/id_rsa_terraform:/.ssh/id_rsa:ro \
    -v ~/.berkshelf:/.berkshelf \
    --workdir /workdir \
    --entrypoint $CMD \
    $CHEF_IMAGE_NAME \
    "$@"
}
