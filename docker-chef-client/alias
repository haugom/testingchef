CHEF_IMAGE_NAME=chef-client

function chef-client() {
  dockerrun chef-client $@
}

function chef() {
  dockerrun chef $@
}

function kitchen() {
  dockerrun kitchen $@
}

function delivery() {
  dockerrun delivery $@
}

function berks() {
  dockerrun berks $@
}

function inspec() {
  dockerrun inspec $@
}

function knife() {
  dockerrun knife $@
}

function chef-shell() {
  dockerrun chef-shell $@
}

function dockerrun() {
  DIGITALOCEAN_TOKEN=$(cat ~/keys/terraform-digitalocean.token)
  DIGITALOCEAN_SSH_KEY_IDS=$(cat ~/keys/terraform-digitalocean.ssh_keys)
  CMD=$1
  shift
  docker run \
    -it \
    --rm \
    -e DIGITALOCEAN_ACCESS_TOKEN \
    -e DIGITALOCEAN_SSH_KEY_IDS \
    -u $UID:$UID \
    -v `pwd`:/workdir \
    -v ~/.chef/haugom.pem:/workdir/.chef/haugom.pem:ro \
    -v ~/.chef/haugom.pem:/etc/chef/client.pem:ro \
    -v ~/.ssh/id_rsa_terraform:/.ssh/id_rsa:ro \
    -v ~/.berkshelf:/.berkshelf \
    -v `pwd`/.inspec:/.inspec \
    --workdir /workdir \
    --entrypoint $CMD \
    $CHEF_IMAGE_NAME \
    "$@"
}
